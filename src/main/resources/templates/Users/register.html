<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:replace="~{fragments :: header('Đăng ký')}"></div>

    <main>
        <form id="registerForm" method="post">
            <div class="mb-3">
                <label for="phoneNumber" class="form-label">Số điện thoại</label>
                <input type="text" name="phoneNumber" class="form-control" placeholder="Số điện thoại">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" name="email" class="form-control" placeholder="Email">
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Mật khẩu</label>
                <input type="password" name="password" class="form-control" placeholder="Mật khẩu">
            </div>
            <div class="mb-3">
                <label for="confirmPassword" class="form-label">Nhập lại mật khẩu</label>
                <input type="password" name="confirmPassword" class="form-control" placeholder="Nhập lại mật khẩu">
            </div>
            <div class="mb-3">
                <label for="name" class="form-label">Họ tên</label>
                <input type="text" name="name" class="form-control" placeholder="Họ tên">
            </div>
            <div class="mb-3">
                <label for="dob" class="form-label">Ngày sinh</label>
                <input type="date" name="dob" class="form-control">
            </div>
            <div class="mb-3">
                <label class="form-label">Giới tính</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="male" value="male">
                    <label class="form-check-label" for="male">Nam</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="female" value="female">
                    <label class="form-check-label" for="female">Nữ</label>
                </div>
            </div>
            

            <button type="submit" class="btn btn-primary">Đăng ký</button>
            <a href="/auth/login" class="btn btn-secondary">Đăng nhập</a>

            <p th:text="${message}"></p>
        </form>

        <form id="fakeRegisterForm" method="post" action="/auth/register">
            <input type="hidden" name="phoneNumber" id="phoneNumber">
            <input type="hidden" name="email" id="email">
            <input type="hidden" name="password" id="password">
            <input type="hidden" name="name" id="name">
            <input type="hidden" name="gender" id="gender">
            <input type="hidden" name="dateOfBirth" id="dateOfBirth">
            <input type="hidden" name="avatarUrl" id="avatarUrl" value="">
        </form>

        <p id="errorMessage" style="color: red;"></p>
            
    </main>

    <div th:replace="~{fragments :: footer}"></div>

    <script>
        let registerForm = document.getElementById("registerForm");
        let fakeRegisterForm = document.getElementById("fakeRegisterForm");
        let errorMessage = document.getElementById("errorMessage");

        
        registerForm.addEventListener("submit", function(event) {
            event.preventDefault();

            const phoneNumber = registerForm.querySelector("input[name='phoneNumber']").value;
            const email = registerForm.querySelector("input[name='email']").value;
            const password = registerForm.querySelector("input[name='password']").value;
            const confirmPassword = registerForm.querySelector("input[name='confirmPassword']").value;
            const name = registerForm.querySelector("input[name='name']").value;
            const gender = registerForm.querySelector("input[name='gender']:checked")?.value; // Added ? to handle unchecked case
            const dateOfBirth = registerForm.querySelector("input[name='dob']").value;

            if (!phoneNumber || !email || !password || !confirmPassword || !name || !gender || !dateOfBirth) { // Removed !role as it's not defined
                errorMessage.textContent = "Vui lòng điền đầy đủ thông tin";
                return;
            }

            if (password !== confirmPassword) {
                errorMessage.textContent = "Mật khẩu không khớp";
                return;
            }

            const newGender = gender === "male" ? true : false;

            fakeRegisterForm.querySelector("#phoneNumber").value = phoneNumber;
            fakeRegisterForm.querySelector("#email").value = email;
            fakeRegisterForm.querySelector("#password").value = password;
            fakeRegisterForm.querySelector("#name").value = name;
            fakeRegisterForm.querySelector("#gender").value = newGender;
            fakeRegisterForm.querySelector("#dateOfBirth").value = dateOfBirth;

            fakeRegisterForm.submit();
        });
    </script>
</body>
</html>
